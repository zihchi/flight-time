<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é£›æ™‚è¨ˆç®—å·¥å…·</title>
<style>
  body {
    font-family: Arial, sans-serif;
    line-height: 1.8;
    margin: 20px;
    max-width: 1024px;
    margin-left: auto;
    margin-right: auto;
  }

  form {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    align-items: flex-end;
  }

  label {
    display: flex;
    flex-direction: column;
    font-size: 15px;
    min-width: 240px;
    flex: 1;
  }

  input[type="date"],
  select {
    padding: 8px 6px;
    font-size: 16px;
    border-radius: 6px;
    border: 1px solid #ccc;
    background-color: #f8f8f8;
    width: 100%;
  }

  .time-row {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-top: 4px;
  }

  .time-row select {
    width: 60px;
  }

  button {
    padding: 8px 16px;
    font-size: 16px;
    margin-top: 20px;
  }

  .button-group {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    flex-wrap: wrap;
  }

  .notes {
    margin-top: 40px;
    border-top: 1px solid #aaa;
    padding-top: 20px;
  }

  .notes img {
    max-width: 100%;
    border-radius: 6px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    margin-top: 20px;
  }

  @media (max-width: 768px) {
    form {
      flex-direction: column;
      align-items: flex-start;
    }

    label {
      width: 100%;
    }

    .time-row {
      justify-content: flex-start;
    }

    .button-group {
      width: 100%;
      justify-content: flex-start;
    }
  }
  .timeline {
    position: relative;
    margin-top: 40px;
    border-top: 2px solid #333;
    height: 60px;
    width: 100%;
  }

  .block {
    position: absolute;
    height: 30px;
    top: 0;
    color: #fff;
    text-align: center;
    line-height: 30px;
    font-size: 13px;
    overflow: hidden;
    white-space: nowrap;
    padding: 0 4px;
    border-radius: 4px;
  }

  .fdp { background-color: #4CAF50; }
  .mfdp { background-color: #2196F3; }
  .mrp { background-color: #FF9800; }
  .rp { background-color: #9E9E9E; }

  .label {
    position: absolute;
    top: 35px;
    font-size: 12px;
    white-space: nowrap;
    transform: translateX(-50%);
  }

  .tick {
    position: absolute;
    top: 30px;
    width: 1px;
    height: 10px;
    background-color: #333;
  }

  .alert {
    color: red;
    font-weight: bold;
  }

  .result p {
    margin: 0;
  }
</style>
    
</head>
<body> 
  <h2>é£›æ™‚è¨ˆç®—å·¥å…·</h2>

<form>
  <label>FDPé–‹å§‹ (UTC æ—¥æœŸ+æ™‚é–“)
    <input type="date" id="checkinDate">
    <div class="time-row">
      <select id="checkinHour"></select>
      <span>:</span>
      <select id="checkinMinute"></select>
    </div>
  </label>

  <label>ä»»å‹™çµæŸ (UTC æ—¥æœŸ+æ™‚é–“)
    <input type="date" id="endDate">
    <div class="time-row">
      <select id="endHour"></select>
      <span>:</span>
      <select id="endMinute"></select>
    </div>
  </label>

  <label>Flight Time (é£›è¡Œæ™‚é–“ ç¸½æ™‚:åˆ†)
    <div class="time-row">
      <select id="ftHour"></select>
      <span>:</span>
      <select id="ftMinute"></select>
    </div>
  </label>

  <label>çµ„å“¡äººæ•¸
    <select id="crew">
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
    </select>
  </label>

  <label>Class 1 ä¼‘æ¯è£å‚™
    <select id="class1">
      <option value="yes">æœ‰</option>
      <option value="no">ç„¡</option>
    </select>
  </label>

  <label>Next Duty (UTC æ—¥æœŸ+æ™‚é–“)
    <input type="date" id="nextDutyDate">
    <div class="time-row">
      <select id="nextDutyHour"></select>
      <span>:</span>
      <select id="nextDutyMinute"></select>
    </div>
  </label>

  <div class="button-group">
    <button id="calculate" type="button">è¨ˆç®—</button>
    <button type="reset">é‡ç½®</button>
  </div>
</form>


  <div class="result" id="result"></div>
  <div class="timeline" id="timeline"></div>
<div class="notes">
  <h3>ğŸ“Œ å‚™è¨»äº‹é …</h3>
  <ul>
    <li>FDP å¾å ±åˆ°é–‹å§‹ç®—ï¼Œç›´åˆ° Block with engine shutdown æˆ– Crew released</li>
    <li>è‡¨æ™‚åŠ äººåªèƒ½ before First Sector (FOM : æœ‰èµ·é£›æ‰ç®—Sectoré–‹å§‹)</li>
    <li>FDP å‰çš„å¾…å‘½ï¼Œå¦‚æœæ²’åœ¨ suitable accommodationï¼Œä¹Ÿæœƒç®—é€² FDPï¼Œåä¹‹å‰‡ä¸ç®—</li>
    <li>å¢åŠ  FDP çš„æ–¹å¼ï¼š<br>
      â”” First Flight Sector ä¹‹å‰æœ‰åœ¨ suitable accommodation ä¼‘æ¯è¶…é 3hr å°±ä¸ç®—é€² FDP Limitationï¼Œ<br>
      â”” First Flight Sector ä¹‹å¾Œï¼Œå‰‡å¯å¢åŠ  1/2 ä¼‘æ¯æ™‚é–“é€²MFDPï¼Œä½†MFDPæœ€å¤šå°±æ˜¯ 24hr</li>
    <li>æ™‚å·® â‰§6hr çš„å¤–ç«™åœç•™è¶…é48hrï¼Œå›åŸºåœ°å¾Œ 48hr å…§ä¸èƒ½å†æ´¾é£ Flight Dutyï¼Œ<br>
      â”” é™¤éåˆé£›å›åŒä¸€å€‹å¤–ç«™ or èˆ‡åŒä¸€å¤–ç«™æ™‚å·® 3hr å…§çš„åœ°é»ï¼ŒDHD ä¸åœ¨æ­¤é™</li>
    <li>FDP in Circadianï¼ˆ02L-05Lï¼‰æœ€å¤š 3 å¤©ï¼Œ<br>
      â”” é€£2 å¤©è¦ä¼‘ 34hrï¼Œé€£3 å¤©è¦ä¼‘ 54hrï¼Œ<br>
      â”” æˆ–æ˜¯æ¯å¤©FDPå¾Œä¼‘ 14hrï¼ˆæœ€å¤šé‚„æ˜¯3å¤©ï¼‰</li>
  </ul>
  <img src="https://raw.githubusercontent.com/zihchi/flight-time/main/%E6%88%AA%E5%9C%96%202025-07-19%2000.05.25.png" alt="Duty Structure" style="max-width: 100%; border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
</div>
</div>        
<script>
function pad(n){ return n.toString().padStart(2,'0'); }
function initSelectors(){
    const hourIds = ["checkinHour","endHour","ftHour","nextDutyHour"];
    const minuteIds = ["checkinMinute","endMinute","ftMinute","nextDutyMinute"];

for (let id of hourIds) {
    const select = document.getElementById(id);
    for (let i = 0; i < 24; i++) {
        select.append(new Option(pad(i), i));
    }
}

for (let id of minuteIds) {
    const select = document.getElementById(id);
    for (let i = 0; i < 60; i++) {
        select.append(new Option(pad(i), i));
    }
}
}

function setDefaultDateToday(){
    const today = new Date();
    const todayStr = today.toISOString().substring(0,10);
    document.getElementById("checkinDate").value = todayStr;
    document.getElementById("endDate").value = todayStr;

    // é è¨­ Next Duty ç‚º 3 å¤©å¾Œçš„åŒä¸€æ™‚é–“
    const nextDutyDate = new Date(today.getTime() + 2 * 24 * 60 * 60 * 1000);
    const nextDutyStr = nextDutyDate.toISOString().substring(0,10);
    document.getElementById("nextDutyDate").value = nextDutyStr;
    document.getElementById("nextDutyHour").value = pad(today.getUTCHours());
    document.getElementById("nextDutyMinute").value = pad(today.getUTCMinutes());
}
document.addEventListener("DOMContentLoaded",()=>{
    initSelectors();
    setDefaultDateToday();    
});
function addBlock(start,width,text,cls){
    const div=document.createElement('div');
    div.className='block '+cls;
    div.style.left=start+'%';
    div.style.width=width+'%';
    div.textContent=text;
    document.getElementById('timeline').appendChild(div);
}
function addLabel(pos,text){
    const div=document.createElement('div');
    div.className='label';
    div.style.left=pos+'%';
    div.textContent=text;
    document.getElementById('timeline').appendChild(div);
}
function addTick(pos){
    const tick=document.createElement('div');
    tick.className='tick';
    tick.style.left=pos+'%';
    document.getElementById('timeline').appendChild(tick);
}
function calculateAll(){
    let cD=document.getElementById('checkinDate').value,eD=document.getElementById('endDate').value;
    let cH=parseInt(document.getElementById('checkinHour').value),cM=parseInt(document.getElementById('checkinMinute').value);
    let eH=parseInt(document.getElementById('endHour').value),eM=parseInt(document.getElementById('endMinute').value);
    let checkinDT=new Date(`${cD}T${pad(cH)}:${pad(cM)}:00Z`);
    let endDT=new Date(`${eD}T${pad(eH)}:${pad(eM)}:00Z`);
    let crew=parseInt(document.getElementById('crew').value);
    let class1=document.getElementById('class1').value==="yes";
    let ftH=parseInt(document.getElementById('ftHour').value), ftM=parseInt(document.getElementById('ftMinute').value);
    let actualFDP=(endDT-checkinDT)/60000;
    let actualFT=ftH*60+ftM;
    let mfdpLimit=crew===2?840:(crew===3?1080:1440);
    let maxRP=crew===2?(actualFT<=480?600:1080):(crew===3?(actualFT<=480?600:(actualFT<=720?1080:1440)):(actualFT<=480?600:(actualFT<=960?1080:1320)));
    let maxFT=crew===2?600:(crew===3?(class1?960:720):(class1?1080:720));
    let rpStart = endDT;
let nextDutyDate = document.getElementById("nextDutyDate").value;
let ndH = parseInt(document.getElementById("nextDutyHour").value || "0", 10);
let ndM = parseInt(document.getElementById("nextDutyMinute").value || "0", 10);
let rpEnd = new Date(`${nextDutyDate}T${pad(ndH)}:${pad(ndM)}:00Z`);
    
    let actualRP = (rpEnd - rpStart) / 60000;
    let result=`<p${actualFDP>mfdpLimit?' class="alert"':''}>FDP: ${Math.floor(actualFDP/60)}h ${actualFDP%60}m / MFDP: ${Math.floor(mfdpLimit/60)}h${actualFDP>mfdpLimit?' âš ï¸ è¶…éé™åˆ¶':''}</p>`;
    result+=`<p${actualFT>maxFT?' class="alert"':''}>FT: ${Math.floor(actualFT/60)}h ${actualFT%60}m / Max FT: ${Math.floor(maxFT/60)}h${actualFT>maxFT?' âš ï¸ è¶…éé™åˆ¶':''}</p>`;
    result+=`<p${actualRP<maxRP?' class="alert"':''}>RP: ${Math.floor(actualRP/60)}h ${actualRP%60}m / MRP: ${Math.floor(maxRP/60)}h${actualRP<maxRP?' âš ï¸ ä¸è¶³':''}</p>`;
    document.getElementById('result').innerHTML=result;
    const timeline=document.getElementById('timeline');timeline.innerHTML='';
    const totalWidth=(rpEnd-checkinDT)/60000;
    addBlock(0,(actualFDP/totalWidth)*100,`FDP ${Math.floor(actualFDP/60)}h ${actualFDP%60}m`,'fdp');
    addBlock(0,(mfdpLimit/totalWidth)*100,`MFDP ${Math.floor(mfdpLimit/60)}h`,'mfdp');
    addBlock(((rpStart-checkinDT)/60000)/totalWidth*100,(maxRP/totalWidth)*100,`MRP ${Math.floor(maxRP/60)}h`,'mrp');
    addBlock(((rpStart-checkinDT)/60000)/totalWidth*100,((rpEnd-rpStart)/60000)/totalWidth*100,`RP ${Math.floor(actualRP/60)}h ${actualRP%60}m${actualRP<maxRP?' âš ï¸ ä¸è¶³':''}`,'rp');
    addTick(0); addTick((actualFDP/totalWidth)*100); addTick(((rpStart-checkinDT)/60000)/totalWidth*100); addTick(((rpEnd-checkinDT)/60000)/totalWidth*100); addTick(100);
    addLabel(0,`FDPé–‹å§‹ ${pad(checkinDT.getUTCMonth()+1)}/${pad(checkinDT.getUTCDate())} ${pad(checkinDT.getUTCHours())}:${pad(checkinDT.getUTCMinutes())}Z`);
    addLabel((actualFDP/totalWidth)*100,`ä»»å‹™çµæŸ ${pad(endDT.getUTCMonth()+1)}/${pad(endDT.getUTCDate())} ${pad(endDT.getUTCHours())}:${pad(endDT.getUTCMinutes())}Z`);
    
    addLabel(((rpEnd - checkinDT) / 60000) / totalWidth * 100,
  `Next Duty ${pad(rpEnd.getUTCMonth()+1)}/${pad(rpEnd.getUTCDate())} ${pad(rpEnd.getUTCHours())}:${pad(rpEnd.getUTCMinutes())}Z`);

}
</script>
</body>
</html>

